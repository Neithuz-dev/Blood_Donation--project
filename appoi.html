<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Donation Slot</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#c21807;         /* blood donation red */
      --accent:#16a34a;        /* green for available */
      --accent-600:#15803d;
      --muted:#6b7280;
      --ring:#e5e7eb;
      --bg:#f8fafc;
      --surface:#ffffff;
      --radius:14px;
      --shadow:0 10px 25px rgba(2,8,23,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#0f172a}
    .wrap{max-width:960px;margin:24px auto;padding:0 16px}
    .h1{font-weight:800;font-size:clamp(20px,4vw,28px)}

    /* Cards & layout */
    .card{background:var(--surface);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:var(--shadow)}
    .pad{padding:16px}
    .section{margin-top:14px}
    .section-title{font-weight:700;margin:0 0 10px 0}

    /* Inputs */
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .input,.select,.textarea{width:100%;padding:12px;border:1px solid var(--ring);border-radius:12px;font:inherit;background:#fff}

    /* Doctor list */
    .doctor-list{display:grid;gap:10px}
    .doctor{display:grid;grid-template-columns:56px 1fr auto;gap:12px;align-items:center;border:1px solid var(--ring);border-radius:12px;padding:10px;cursor:pointer;transition:background-color .2s}
    .doctor.selected{background:#fffbeb;border-color:#fef08a} /* Highlight selected doctor */
    .doctor:hover:not(.selected){background:#f9fafb}
    .doctor img{width:56px;height:56px;border-radius:50%;object-fit:cover;border:2px solid #eef2f7}
    .doctor h4{margin:0 0 2px 0;font-size:15px}
    .meta{font-size:12px;color:var(--muted)}
    .tag{display:inline-block;background:#ecfdf5;border:1px solid #a7f3d0;padding:4px 8px;border-radius:999px;font-size:12px}
    .btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:linear-gradient(180deg,var(--brand),#a31506);color:#fff}
    .btn-outline{background:#fff;border:1px solid var(--ring)}

    /* Calendar */
    .calendar{display:grid;gap:10px}
    .cal-head{display:flex;justify-content:space-between;align-items:center}
    .cal-ctrl{border:1px solid var(--ring);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:600}
    .month{font-weight:800}
    .weekdays,.days{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .weekdays div{font-size:12px;color:var(--muted);text-align:center}
    .day{aspect-ratio:1/1;border:1px solid var(--ring);border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative}
    .day.faded{color:#cbd5e1;cursor:not-allowed;background:#f8fafc}
    .day.available{box-shadow:inset 0 0 0 2px #bbf7d0}
    .day.selected{box-shadow:inset 0 0 0 2px var(--accent);border-color:var(--accent)}
    .dot{position:absolute;bottom:6px;width:6px;height:6px;border-radius:50%;background:var(--accent)}

    /* Slots */
    .slots{display:grid;gap:10px}
    .slot-list{display:flex;flex-wrap:wrap;gap:8px}
    .slot{padding:12px 16px;border:1px solid var(--accent);border-radius:12px;background:#ecfdf5;cursor:pointer;font-weight:700}
    .slot.disabled{border-color:#e5e7eb;background:#f1f5f9;color:#94a3b8;cursor:not-allowed}
    .slot.selected{background:linear-gradient(180deg,var(--accent),var(--accent-600));border-color:transparent;color:#fff}

    /* Summary */
    .summary{display:grid;gap:8px}
    .line{display:flex;justify-content:space-between;gap:10px}
    .label{color:var(--muted);font-size:13px}
    .value{font-weight:700}
    .divider{height:1px;background:var(--ring);margin:6px 0}
    .cta{width:100%;padding:14px;border-radius:12px;border:0;cursor:pointer;font-weight:800;color:#fff;background:linear-gradient(180deg,var(--brand),#a31506)}
    .cta:disabled{opacity:.6;cursor:not-allowed}

     @media (min-width:900px){
      .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="h1"> Book Donation Screening</div>

    <div class="grid">
      <div>
               <div class="card pad section">
          <div class="section-title">1) Choose Blood Bank Doctor / Team</div>
          <div class="row">
            <input id="search" class="input" type="search" placeholder="Search (doctor, specialty, hospital)" />
            <select id="spec" class="select">
              <option value="">All Specialties</option>
              <option>Transfusion Medicine</option>
              <option>Hematology</option>
              <option>Blood Bank</option>
              <option>Pathology</option>
            </select>
          </div>
          <div id="doctorList" class="doctor-list"></div>
        </div>

               <div class="card pad section">
          <div class="section-title">2) Pick a Date</div>
          <div class="calendar">
            <div class="cal-head">
              <div style="display:flex;gap:8px">
                <button id="prev" class="cal-ctrl" aria-label="Previous month">◀</button>
                <button id="next" class="cal-ctrl" aria-label="Next month">▶</button>
              </div>
              <div id="month" class="month"></div>
              <button id="jump" class="cal-ctrl" title="Next available">Next Available</button>
            </div>
            <div class="weekdays"><div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div></div>
            <div id="days" class="days"></div>
          </div>
        </div>

               <div class="card pad section">
          <div class="section-title">3) Pick a Time</div>
          <div id="slots" class="slots">
            <div class="slot-list" id="slotList"></div>
            <div style="color:var(--muted);font-size:13px">Unavailable or recently booked times are greyed out.</div>
          </div>
        </div>

               <div class="card pad section">
          <div class="section-title">4) Your Details</div>
          <form id="form">
            <input id="pName" class="input" placeholder="Full Name" required />
            <div class="row" style="margin-top:8px">
              <input id="pEmail" class="input" type="email" placeholder="Email" required />
              <input id="pPhone" class="input" type="tel" placeholder="Phone" required />
            </div>
            <textarea id="pReason" class="textarea" rows="3" placeholder="Reason for visit (optional)"></textarea>
            <button id="confirm" class="cta" type="submit" disabled>Confirm & Book</button>
          </form>
        </div>
      </div>

            <aside class="card pad section">
        <div class="section-title">Summary</div>
        <div class="summary">
          <div class="line"><div class="label">Doctor</div><div id="sDoctor" class="value">—</div></div>
          <div class="line"><div class="label">Specialty</div><div id="sSpec" class="value">—</div></div>
          <div class="line"><div class="label">Date</div><div id="sDate" class="value">—</div></div>
          <div class="line"><div class="label">Time</div><div id="sTime" class="value">—</div></div>
          <div class="line"><div class="label">Fee</div><div id="sFee" class="value">Free</div></div>
          <div class="divider"></div>
          <div style="font-size:12px;color:var(--muted)">Donation screening is free. Please arrive 10 minutes early.</div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // --- Blood donation-focused doctors ---
    const doctors = [
      { id:1, name:'Dr. Meera Pillai', specialty:'Transfusion Medicine', experience:10, fee:0, photo:'https://images.unsplash.com/photo-1550831107-1553da8c8464?q=80&w=256&auto=format&fit=crop' },
      { id:2, name:'Dr. A. K. Varma', specialty:'Hematology', experience:14, fee:0, photo:'https://images.unsplash.com/photo-1556157382-97eda2d62296?q=80&w=256&auto=format&fit=crop' },
      { id:3, name:'Dr. Fathima N.', specialty:'Blood Bank', experience:8, fee:0, photo:'https://images.unsplash.com/photo-1604881991720-f91add269bed?q=80&w=256&auto=format&fit=crop' },
      { id:4, name:'Dr. Rohan Mathew', specialty:'Hematology', experience:11, fee:0, photo:'https://images.unsplash.com/photo-1544723795-3fb6469f5b39?q=80&w=256&auto=format&fit=crop' },
    ];

    const slotTemplate = [
      '09:00','09:30','10:00','10:30','11:00','11:30',
      '12:00','12:30','13:00','13:30','14:00','14:30','15:00','15:30','16:00','16:30',
      '17:00','17:30'
    ];

    // Deterministic pseudo-availability for demo
    function xmur3(str){let h=1779033703^str.length;for(let i=0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=h<<13|h>>>19;}return function(){h=Math.imul(h^h>>>16,2246822507);h=Math.imul(h^h>>>13,3266489909);return (h^h>>>16)>>>0}/4294967296}
    function availabilityFor(dateKey){
      const rng = xmur3(dateKey)();
      const unavailable = new Set();
      slotTemplate.forEach(s=>{ if (rng() < 0.22) unavailable.add(s); });
      return slotTemplate.map(t=>({ time:t, available:!unavailable.has(t) }));
    }

    // DOM refs
    const doctorList = document.getElementById('doctorList');
    const search = document.getElementById('search');
    const spec = document.getElementById('spec');
    const month = document.getElementById('month');
    const days = document.getElementById('days');
    const prev = document.getElementById('prev');
    const next = document.getElementById('next');
    const jump = document.getElementById('jump');
    const slotList = document.getElementById('slotList');

    const sDoctor = document.getElementById('sDoctor');
    const sSpec = document.getElementById('sSpec');
    const sDate = document.getElementById('sDate');
    const sTime = document.getElementById('sTime');
    const sFee = document.getElementById('sFee');
    const form = document.getElementById('form');
    const confirmBtn = document.getElementById('confirm');

    let state = { doctor:null, year:new Date().getFullYear(), month:new Date().getMonth(), date:null, time:null };

    // Render doctors
    function renderDoctors(){
      const q = search.value.trim().toLowerCase();
      const f = spec.value;
      const list = doctors.filter(d => (!f || d.specialty===f) && (!q || d.name.toLowerCase().includes(q) || d.specialty.toLowerCase().includes(q)));
      doctorList.innerHTML='';
      list.forEach(d=>{
        const el = document.createElement('div');
        el.className='doctor';
        if(state.doctor && state.doctor.id === d.id) el.classList.add('selected');
        el.innerHTML = `
          <img src="${d.photo}" alt="${d.name}" />
          <div>
            <h4>${d.name}</h4>
            <div class="meta">${d.specialty} • ${d.experience} yrs</div>
            <div class="tag" style="margin-top:6px">Donation Screening • Free</div>
          </div>
          <button class="btn btn-primary">Select</button>`;
        el.addEventListener('click',()=>selectDoctor(d, el));
        doctorList.appendChild(el);
      });
      if(!list.length){
        const empty=document.createElement('div'); empty.style.cssText='padding:8px;color:var(--muted)'; empty.textContent='No matches.'; doctorList.appendChild(empty);
      }
    }

    function selectDoctor(d, el){
      state.doctor=d; sDoctor.textContent=d.name; sSpec.textContent=d.specialty; sFee.textContent='Free';
      document.querySelectorAll('.doctor').forEach(doc => doc.classList.remove('selected'));
      if(el) el.classList.add('selected');
      updateConfirmState();
    }

    search.addEventListener('input', renderDoctors);
    spec.addEventListener('change', renderDoctors);

    // Calendar
    function renderCalendar(){
      const first = new Date(state.year, state.month, 1);
      const last = new Date(state.year, state.month + 1, 0);
      // Sunday=0, Monday=1, ..., Saturday=6
      const startDay = first.getDay();
      month.textContent = first.toLocaleString(undefined,{month:'long', year:'numeric'});
      days.innerHTML='';
      
      // Fix: Add correct number of faded cells for the start of the month
      for(let i=0;i<startDay;i++){ 
        const d=document.createElement('div'); 
        d.className='day faded'; 
        days.appendChild(d); 
      }
      
      const today=new Date(); today.setHours(0,0,0,0);
      for(let day=1; day<=last.getDate(); day++){
        const cell=document.createElement('button'); cell.type='button'; cell.className='day'; cell.textContent=day;
        const dateObj=new Date(state.year,state.month,day);
        
        if(dateObj<today){ 
          cell.classList.add('faded'); cell.disabled=true; 
        }
        
        // Check availability
        const hasAvail = availabilityFor(key(dateObj)).some(s=>s.available);
        if(hasAvail && dateObj>=today){ 
          cell.classList.add('available'); 
          // If the day has slots, add the indicator dot (optional visual)
          const dot = document.createElement('div');
          dot.className = 'dot';
          cell.appendChild(dot);
        } else if (dateObj >= today) {
          // Disable future days without available slots
          cell.classList.add('faded'); 
          cell.disabled=true; 
        }

        cell.addEventListener('click',()=>selectDate(dateObj));
        days.appendChild(cell);
      }
      highlightSelectedDay();
      renderSlots();
    }

    function highlightSelectedDay(){
      [...days.querySelectorAll('.day')].forEach(el=>el.classList.remove('selected'));
      if(!state.date) return;
      
      // Fix: Correctly calculate the index relative to the start of the days grid
      const dayOfMonth = state.date.getDate();
      const firstDayOfMonth = new Date(state.year, state.month, 1).getDay();
      const index = firstDayOfMonth + dayOfMonth - 1;

      const el = days.children[index]; 
      if(el) el.classList.add('selected');
    }

    function selectDate(d){ 
      state.date=d; 
      sDate.textContent=d.toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric'}); 
      sTime.textContent='—'; 
      state.time=null; 
      renderSlots(); 
      highlightSelectedDay(); 
      updateConfirmState(); 
    }
    
    prev.addEventListener('click',()=>{ 
      // Prevent navigating to past months
      const today = new Date();
      if (state.year === today.getFullYear() && state.month <= today.getMonth()) return;
      
      state.month--; 
      if(state.month<0){state.month=11; state.year--} 
      state.date = null; // Clear date selection on month change
      renderCalendar(); 
    });
    next.addEventListener('click',()=>{ 
      state.month++; 
      if(state.month>11){state.month=0; state.year++} 
      state.date = null; // Clear date selection on month change
      renderCalendar(); 
    });
    jump.addEventListener('click',()=>{
      const start = new Date(); start.setHours(0,0,0,0);
      for(let i=0;i<90;i++){
        const d = new Date(start.getFullYear(), start.getMonth(), start.getDate()+i);
        if(availabilityFor(key(d)).some(s=>s.available)){
          state.year=d.getFullYear(); state.month=d.getMonth(); renderCalendar(); selectDate(d); break;
        }
      }
    });

    // Slots
    function renderSlots(){
      slotList.innerHTML='';
      if(!state.date){ slotList.innerHTML='<div class="meta">Select a date to see slots.</div>'; return; }
      const avail = availabilityFor(key(state.date));
      
      // Check if the selected date is today
      const now = new Date();
      const isToday = now.toDateString() === state.date.toDateString();

      avail.forEach(({time,available})=>{
        const b=document.createElement('button'); 
        b.type='button'; 
        b.textContent=to12h(time); 
        
        let isPastTime = false;
        if (isToday) {
          const [hour, minute] = time.split(':').map(Number);
          // Check if the slot time is in the past relative to the current time
          if (hour < now.getHours() || (hour === now.getHours() && minute <= now.getMinutes())) {
            isPastTime = true;
          }
        }
        
        const isSlotAvailable = available && !isPastTime;

        b.className='slot'+(isSlotAvailable?'':' disabled');
        if(isSlotAvailable){ 
          b.addEventListener('click',()=>selectTime(time,b)); 
          if(state.time===time) b.classList.add('selected'); 
        }
        slotList.appendChild(b);
      });

      if (avail.every(slot => !slot.available) && !slotList.children.length) {
        slotList.innerHTML = '<div class="meta">No available slots on this date. Please choose another day.</div>';
      }
    }

    function selectTime(t,el){ 
      state.time=t; 
      sTime.textContent=to12h(t); 
      document.querySelectorAll('.slot').forEach(s=>s.classList.remove('selected')); 
      el.classList.add('selected'); 
      updateConfirmState(); 
    }

    // Check all steps are complete
    function updateConfirmState(){ 
      confirmBtn.disabled = !(state.doctor && state.date && state.time); 
    }

    // Form submit (demo only)
    form.addEventListener('submit',(e)=>{
      e.preventDefault(); if(confirmBtn.disabled) return;
      const payload={
        doctorId: state.doctor.id, doctorName: state.doctor.name, specialty: state.doctor.specialty,
        dateISO: state.date.toISOString(), time: state.time, fee: 0,
        patient:{ name:document.getElementById('pName').value, email:document.getElementById('pEmail').value, phone:document.getElementById('pPhone').value, reason:document.getElementById('pReason').value }
      };
      alert(`Donation slot booked!\n\nDoctor: ${payload.doctorName}\nDate: ${new Date(payload.dateISO).toDateString()}\nTime: ${to12h(payload.time)}\nFee: Free`);
      
      // Reset state for a new booking
      form.reset(); 
      state.time=null; 
      state.date=null;
      renderSlots();
      renderCalendar();
      sDate.textContent='—'; 
      sTime.textContent='—';
      updateConfirmState();
    });

    // Utils
    function key(d){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}
    function to12h(t){let [h,m]=t.split(':').map(Number); const am=h>=12?'PM':'AM'; h=h%12||12; return `${h}:${String(m).padStart(2,'0')} ${am}`}

    // Init
    // Automatically select the first doctor for a better start
    selectDoctor(doctors[0]);
    renderDoctors(); 
    renderCalendar();
  </script>
</body>
</html>
